[https://github.com/umdjs/umd](https://github.com/umdjs/umd)
[https://blog.csdn.net/lengye7/article/details/123622296](https://blog.csdn.net/lengye7/article/details/123622296)

### 一 UMD

UMD(Universal Module Definition - 通用模块定义)模式，该模式主要用来**解决 CommonJS 模式和 AMD 模式代码不能通用的问题**，并同时还支持老式的全局变量规范。**其实就是一种兼容各大模块方式的写法**。

1. demo

    ```js
    // bundle.js
    (function (global, factory) {
        //1.判断define为函数，并且是否存在define.amd，来判断是否为AMD规范,
        //2.判断module是否为一个对象，并且是否存在module.exports来判断是否为CommonJS规范
        //3.如果以上两种都没有，设定为原始的代码规范。
        typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
        typeof define === 'function' && define.amd ? define(factory) :(global = global || self, global.myBundle = factory());
    }(this, (function () {
        'use strict';

        var main = () => {
            return 'hello world';
        };

        return main;

    })));
    // index.html
    <script src="bundle.js"></script>
    <script>
    console.log(myBundle());
    </script>
    ```

    ```js
    // moduleA.js
    ;(function (root, factory) {
        if (typeof module === 'object' && typeof module.exports === 'object') {
            console.log('是commonjs模块规范，nodejs环境')
            module.exports = factory()
        } else if (typeof define === 'function' && define.amd) {
            console.log('是AMD模块规范，如require.js')
            define(function (require, exports, module) {
                module.exports = factory()
            })
        } else if (typeof define === 'function' && define.cmd) {
            console.log('是CMD模块规范，如sea.js')
            define(function (require, exports, module) {
                module.exports = factory()
            })
        } else {
            console.log('没有模块环境，直接挂载在全局对象上')
            root.umdModule = factory(root)
        }
    })(this, function () {
        return {
            helloA: function () {
                console.log('moduleA!')
            },
        }
    })

    //main.js
    ;(function (root, factory) {
        if (typeof module === 'object' && typeof module.exports === 'object') {
            console.log('是commonjs模块规范，nodejs环境')
            var depModule = require('./moduleA.js')
            module.exports = factory(depModule)
        } else if (typeof define === 'function' && define.amd) {
            console.log('是AMD模块规范，如require.js')
            define(function (require, exports, module) {
                var depModule = require('./moduleA')
                module.exports = factory(depModule)
            })
        } else if (typeof define === 'function' && define.cmd) {
            console.log('是CMD模块规范，如sea.js')
            define(function (require, exports, module) {
                var depModule = require('./moduleA')
                module.exports = factory(depModule)
            })
        } else {
            console.log('没有模块环境，直接挂载在全局对象上')
            root.umdModule = factory(root.depModule)
        }
    })(this, function (depModule) {
        console.log('我调用了依赖模块', depModule)
        depModule.helloA()
        // ...省略了一些代码，去代码仓库看吧
        return {
            name: '我自己是一个umd模块',
        }
    })
    ```

    ```js
    //UMD 的代码实现如下：
    ;(function (root, factory) {
        if (typeof define === 'function' && define.amd) {
            define([], factory)
        } else if (typeof exports === 'object') {
            module.exports, (module.exports = factory())
        } else {
            root.returnExports = factory()
        }
    })(this, function () {
        // 模块内容定义
        return {}
    })
    ```
