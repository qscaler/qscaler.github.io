<!--
 * @Author              : qxp
 * @Date                : 2021-03-24 17:26:35
 * @LastEditors         : Please set LastEditors
 * @LastEditTime        : 2021-03-24 17:33:35
 * @FilePath            : \new\6 Es6\10 Promise 对象\10 Promise面试题 copy.html
-->
<script>

    const timeout = ms => new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve();
        }, ms);
    });

    const ajax1 = () => timeout(2000).then(() => {
        debugger
        console.log('1');
        return 1;
    });

    const ajax2 = () => timeout(1000).then(() => {
        debugger
        console.log('2');
        return 2;
    });

    const ajax3 = () => timeout(2000).then(() => {
        debugger
        console.log('3');
        return 3;
    });

    const mergePromise = ajaxArray => {
        // 在这里实现你的代码
        var data = [];

        // Promise.resolve方法调用时不带参数，直接返回一个resolved状态的 Promise 对象。
        // var sequence = Promise.resolve();

        // ajaxArray.forEach(function (item) {
        //     // 第一次的 then 方法用来执行数组中的每个函数，
        //     // 第二次的 then 方法接受数组中的函数执行后返回的结果，
        //     // 并把结果添加到 data 中，然后把 data 返回。
        //     sequence = sequence.then(item).then(function (res) {
        //         debugger
        //         data.push(res);
        //         return data;
        //     });
        // })

        // var sequence = Promise.resolve();
        // sequence = sequence.then(ajax1).then(function (res) {
        //     data.push(res);
        //     return data;
        // });
        // sequence = sequence.then(ajax2).then(function (res) {
        //     data.push(res);
        //     return data;
        // });
        // sequence = sequence.then(ajax3).then(function (res) {
        //     data.push(res);
        //     return data;
        // });
        //  return sequence;

        return Promise.resolve().then(ajax1).then(function (res) {
            data.push(res);
            return data;
        }).then(ajax2).then(function (res) {
            data.push(res);
            return data;
        }).then(ajax3).then(function (res) {
            data.push(res);
            return data;
        });

        // 遍历结束后，返回一个 Promise，也就是 sequence， 他的 [[PromiseValue]] 值就是 data，
        // 而 data（保存数组中的函数执行后的结果） 也会作为参数，传入下次调用的 then 方法中。


    };

    mergePromise([ajax1, ajax2, ajax3]).then(data => {
        console.log('done');
        console.log(data); // data 为 [1, 2, 3]
    });
    // 要求分别输出
    // 1
    // 2
    // 3
    // done
    // [1, 2, 3]
</script>